define(["underscore","./utils/object","./utils/ajax","utils","./event-dispatchers/dot-notation-event-dispatcher"],function(t,e,i,s,n){"use strict";return function(s){var a=n(),r=a.on,d=t.extend(a,{get:function(t){return e.get(this.data,t)},set:function(i,s){var n=this.get(i),a=t.isEmpty(n);return n!==s&&(e.set(this.data,i,s),null!==s&&void 0!==s||a?this.trigger(i+".changed"):(t.isArray(this.data)&&(this.data=t.compact(this.data)),this.trigger(i+".deleted"))),s},add:function(e){return t.isArray(this.data)&&(t.findWhere(this.data,{id:e.id})||this.set(this.data.length.toString(),e)),this},remove:function(e){if(t.isArray(this.data)){var i=this;t.find(this.data,function(t,s){return t===e?(i.set(s.toString(),void 0),!0):!1})}return this},setAll:function(t){return this.data=t,this.trigger(void 0===t?"deleted":"changed"),this},headers:function(t){return this.headers=i.parseAllResponseHeaders(t),this},on:function(e,i,s){var n=this.eventCache.length,a=e.split("."),d=a[a.length-1];("completed"!==d||this.completed!==!0)&&r.apply(this,arguments);var h=this.eventCache.length>n;(h&&"changed"===d&&!t.isEmpty(this.data)||"completed"===d&&this.completed===!0)&&t.defer(function(){i.call(s)})},destroy:function(){this.setAll(void 0)}});return d.setAll(s||{})}});