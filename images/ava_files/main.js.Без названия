define(["jquery","underscore","plugin-dependencies","common/datastore/sharedcloud/filesroot/read","common/utils/currentCollection","common/utils/log","common/searchform/view","./section/files/el","./section/mobile/el","./section/mobile/elv2","./section/libraries/el","files/data/paginatedCollection","files/drag-and-drop/main","plugins/ccweb.collections.mobile-ecosystem/models/syncgroups","plugins/ccweb.collections.mobile-ecosystem-v2/models/projects","plugins/ccweb.collections.libraries/data","text!./template.html","text!./empty.html","text!./error.html","css!./template.css"],function(e,t,l,n,r,i,a,s,o,c,d,u,f,m,p,b,h,g,v){"use strict";var C=null,R=0,y=0,_=t.partial(l.log(),"ets"),w=l.utils.createTemplate(v);return function(){var v=e(h),E=function(e,t){var n=U.$el.find(".stellar-Recent-"+e);n.find(".stellar-Recent-section").length&&n.find(".stellar-Recent-section").remove(),n.find(".stellar-Recent-empty").length&&n.find(".stellar-Recent-empty").remove(),n.removeClass("stellar-Recent-loading"),"files"===e?n.append(new s(t)):"mobile"===e?n.append(l.stellarConfig.get("ccweb.collections.mobile-ecosystem-v2",!0)?new c(p):new o(t)):"libraries"===e&&n.append(new d(t))},S=function(e){var t=v.find(".stellar-Recent-"+e),n={files:l.translate("Files"),mobile:l.translate("Mobile Creations"),libraries:l.translate("Libraries")},r=n[e]||l.translate("Your Assets");t.append(w({title:l.translate("{0} are temporarily unavailable",r),message:l.translate("Sorry for the inconvenience. {0} should be back up shortly. Try refreshing your browser in a few minutes. Please check the {1}status page{2} if the problem persists.",r,'<a href="http://status.creativecloud.com/" target="_blank">',"</a>")})),t.removeClass("stellar-Recent-loading")},L=function(e){var t=v.find(".stellar-Recent-"+e);t.find(".stellar-Recent-empty").length&&t.find(".stellar-Recent-empty").remove(),t.append(g),t.removeClass("stellar-Recent-loading");var n=t.find(".stellar-Recent-emptyTitle"),r=t.find(".stellar-Recent-emptyParagraph"),i=t.find(".stellar-Recent-emptyLink");"files"===e?(n.text(l.translate("You have no Files")),r.html(l.translate("Keep your desktop files automatically synced with Creative Cloud, so you can access them from any device, browser, and Creative Cloud mobile apps.")),i.text(l.translate("Download the desktop sync app")),i.attr("href",l.utils.goURL("http://www.adobe.com/go/cc_files_desktop_sync")),i.on("click",function(){_({code:"CC_RECENTS_USAGE",sub_code:"FILES_EMPTY"})})):"mobile"===e?(n.text(l.translate("You have no Mobile Creations")),r.html(l.translate("Use the Creative Cloud mobile apps to set your ideas in motion. Expand your creativity away from the desktop and turn your inspiration into creative assets.")),i.text(l.translate("Explore the mobile apps")),i.attr("href",l.utils.goURL("http://www.adobe.com/go/cc_mobile_catalog")),i.on("click",function(){_({code:"CC_RECENTS_USAGE",sub_code:"MOBILE_EMPTY"})})):"libraries"===e&&(n.text(l.translate("You have no Libraries")),r.html(l.translate("Save all your essential creative ingredients &mdash; colors, text styles, brushes and more &mdash; in a Library. Storing them in the cloud lets you access them in Photoshop, Illustrator, mobile apps and the web.")),i.text(l.translate("Learn how to use Libraries")),i.attr("href",l.utils.goURL("http://www.adobe.com/go/cclibraries_help")),i.on("click",function(){_({code:"CC_RECENTS_USAGE",sub_code:"LIBRARIES_EMPTY"})}))},x=function(){C&&E("files",C),n().then(function(e){i("fetched.files.data"),r.set(e);var t=new u(e,{max:6,sortAttribute:"updated",sortOrder:"desc"});t.at(0).then(function(e){var t=e._embedded&&e._embedded.resources&&e._embedded.resources.length||0;t>0?(R!==e.updated||y!==e.total_resource_count)&&(R=e.updated,y=e.total_resource_count,C=e._embedded.resources,E("files",C)):L("files")}).fail(function(){S("files")})})},A=function(){C=null,x()},T=function(e,l){if(!t.isNull(e)||"error"===l._syncState)return void S("libraries");var n=l&&l.libraries;if(n&&n.length>0){var r=[];t.each(n,function(e){r.push(e);var l=t.sortBy(r,function(e){return-e.modified});E("libraries",l)})}else L("libraries")},k=function(){var e=m.getAll(),l=!0;if(e.length>0){var n=[];t.each(e,function(e){e.data&&t.each(e.data,function(e){if(e&&e.getName()){l=!1,n.push(e);var r=t.sortBy(n,function(e){return-new Date(e.getModified()||e.getCreated()).getTime()});E("mobile",r)}})}),l&&L("mobile")}else L("mobile")},I=function(){p.length?E("mobile"):L("mobile")},U={$el:v,show:function(){i.start("recents")("routeHit"),v.find(".stellar-Recent-ccTitle").text("Creative Cloud"),v.find(".stellar-Recent-title").text(l.translate("Recent")),v.find(".stellar-Recent-filesTitle").text(l.translate("Files")),v.find(".stellar-Recent-mobileTitle").text(l.translate("Mobile Creations")),v.find(".stellar-Recent-librariesTitle").text(l.translate("Libraries")),v.find(".stellar-Recent-viewAll").text(l.translate("View All"));var t=new a;return v.find(".stellar-Recent-title").append(e("<div>",{"class":"stellar-Search-block"})),v.find(".stellar-Search-block").append(t.render().$el),l.browserUtils.isDragAndDrop&&f.init({$el:v},!0),v.find(".stellar-Recent-files .stellar-Recent-viewAll").click(function(e){e.preventDefault(),_({code:"CC_RECENTS_USAGE",sub_code:"FILES_CLICK"}),l.router.navigate("/files",{trigger:!0,replace:!1})}),v.find(".stellar-Recent-mobile .stellar-Recent-viewAll").click(function(e){e.preventDefault(),_({code:"CC_RECENTS_USAGE",sub_code:"MOBILE_CLICK"}),l.router.navigate("/assets/mobile",{trigger:!0,replace:!1})}),v.find(".stellar-Recent-libraries .stellar-Recent-viewAll").click(function(e){e.preventDefault(),_({code:"CC_RECENTS_USAGE",sub_code:"LIBRARIES_CLICK"}),l.router.navigate("/assets/libraries",{trigger:!0,replace:!1})}),x(),l.stellarConfig.get("ccweb.collections.mobile-ecosystem-v2",!0)?(p.on("sync",I),(p.length||p.state.get("dirty")===!1)&&I()):(m.init(),m.on("completed",k),m.on("error",function(){S("mobile")})),b.libraries.getLibraries("all",T),l.events.on("upload:complete",A),i.logDOMChanges(v,3e3,i.end),U},hide:function(){return m.off("completed",k),p.off("sync",I),l.events.off("upload:complete",A),U},sizeChange:function(){return U}};return U}});