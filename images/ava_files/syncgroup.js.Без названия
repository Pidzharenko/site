define(["require","jquery","underscore","common/model","./ccstorage-asset"],function(e,t,n,r,i){"use strict";var o=function(){var n={};return function(r){if(n[r])return n[r];var i=n[r]=t.Deferred();return e([r],i.resolve,i.reject),i.promise()}}();return function(e){var c="./"+e,d=i(),s=function(){var e=n.reject(n.values(this.data),function(e){return!e||e.error}),t=n.findWhere(e,{completed:!1});d.completed&&(this.empty||e.length&&!t)&&(this.completed=!0,this.trigger("completed"))},u=function(){var t=this,r={},i=0,u=d.get("children")||[],l=function(){t.empty=!0,t.completed=!0,t.trigger("changed"),t.trigger("completed")};return 0===u.length?void l():void n.each(u,function(d){var a=d.name;o(c).done(function(e){r[a]=e(t,a)}).always(function(){i++,i===u.length&&(n.each(r,function(n){n.on("deleted",h,n),n.on("error",h,n),n.on("completed",s,t),n.init(e,n.id+"/manifest")}),0===n.keys(r).length?l():t.setAll(r))})})},h=function(){this.off("deleted",h),l.set(this.id,void 0),0===n.compact(n.values(l.data)).length&&(l.empty=!0,this.trigger("completed"))},l={init:n.once(function(){return this.id=e,this.empty=!1,this.completed=!1,this.projects=d,d.init(this.id),d.on("children.changed",u,this),d.on("completed",s,this),this}),getProject:function(e){var n=this.get(e);if(n)return t.Deferred().resolve(n);var r=this;return this.init(),o(c).then(function(t){return n=t(r,e).init(r.id,e+"/manifest"),n.on("deleted",h,n),n.on("error",h,n),n.on("completed",s,r),r.set(e,n),n})}};return n.extend(l,r())}});